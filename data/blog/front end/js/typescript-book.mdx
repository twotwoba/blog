---
title: 'è‡ªç”¨ TS æ‰‹å†Œ'
date: '2024-07-26'
tags: ['javascript']
summary: 'è¯´æ¥æƒ­æ„§ï¼Œå†™äº† 3 å¹´çš„ tsï¼Œå°½ç®¡ä¸æ˜¯ anyscript é£æ ¼ï¼Œä½†æ˜¯è·Ÿæºç ä¸­çš„ä¸€äº›ç±»å‹ä½“æ“æ¯”èµ·æ¥ï¼Œç•¥æ˜¾ç¨šå«©ï¼Œè€Œä¸”ç°åœ¨è¶Šæ¥è¶Šè§‰å¾—**ä»£ç è®¾è®¡ä¼˜å…ˆ**ï¼Œä»£ç ç¼–å†™å°±æ˜¯ä¸ªä½“åŠ›æ´»ç½¢äº†ã€‚ so~ï¼Œå›ç‚‰é‡é€ ï¼'
images: []
---

> åªä¼šå†™åŸºç¡€TSå°±è·Ÿå¤„å¤„å†™é‡å¤ä»£ç ä¸ä¼šæŠ½é€šç”¨æ¨¡å—ã€åŠŸèƒ½å‡½æ•°çš„ js åˆå­¦è€…ä¸€æ ·ä¸€æ ·çš„ï¼Œrunæ˜¯èƒ½runï¼Œå°±æ˜¯æœ‰ç‚¹è´¹é”®ç›˜...

- [TS å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/docs/handbook/intro.html), åŸºç¡€éƒ¨åˆ†å»ºè®®é€šè¯»ï¼Œæœ¬æ–‡å°†è®°å½•ä¸€äº›æœ‰ç”¨ä¸”å¸¸ç”¨çš„ TS æ¦‚å¿µå’ŒæŠ€å·§

---

## åŸºç¡€ç±»å‹

æƒé‡ï¼šè¶Šå¾€ä¸Šè¶Šå¤§ï¼Œè¶Šå¾€ä¸‹è¶Šå°ã€‚

![ts-basic-types](/static/images/ts-basic-types.png)

åŸºç¡€è¿ç®—ï¼š

- `|`ï¼Œè”åˆç±»å‹
    - å­˜åœ¨çˆ¶å­å…³ç³»ï¼Œåˆ™ç»“æœæ˜¯ç±»å‹æƒé‡è¾ƒ`å¤§`çš„é‚£ä¸ªï¼›æ²¡æœ‰çˆ¶å­å…³ç³»åˆ™ä¸º`è”åˆç±»å‹`
    - åœ¨äºŒè¿›åˆ¶ä½è¿ç®—é‡Œï¼Œ`|` ä¼šæœ‰å¢åŠ å±æ€§çš„åŠŸèƒ½ï¼ŒTS é‡Œä¹Ÿç±»ä¼¼ï¼Œä½¿å¾—ç±»å‹èŒƒå›´å¢åŠ ï¼Œä½†èµ‹å€¼æ—¶åªèƒ½å‘½ä¸­å…¶ä¸­æŸä¸€ä¸ªç±»å‹
- `&`ï¼Œäº¤å‰ç±»å‹
    - å­˜åœ¨çˆ¶å­å…³ç³»ï¼Œåˆ™ç»“æœæ˜¯ç±»å‹æƒé‡è¾ƒ`å°`çš„é‚£ä¸ªï¼›æ²¡æœ‰çˆ¶å­å…³ç³»åˆ™ä¸º `never`
    - åœ¨å¯¹è±¡ç±»å‹ä¸­å°±æ˜¯åˆå¹¶å¯¹è±¡ç±»å‹

ç‰¹æ®Šçš„ `any` æ—¢ä¸ºé¡¶éƒ¨ç±»å‹ä¹Ÿä¸ºåº•éƒ¨ç±»å‹ï¼š

```ts
type t1 = any | unknown // any
type t2 = any & unknown // any
```

ç‰¹æ®Šçš„ï¼Œ`never` åœ¨è”åˆç±»å‹ä¸­ä¼šè¢«è¿‡æ»¤æ‰ï¼š

```ts
// è·å–å‡½æ•°å±æ€§çš„é”®å€¼
interface Demo {
    a: string
    b: number
    d: () => string[]
    e: () => string[]
    f: () => number[]
}
type GetDemoFnKeyTypes<T, K> = {
    [P in keyof T]: T[P] extends K ? P : never // TS ä¸­çš„éå†å±æ€§ï¼Œç±»ä¼¼ä¸ JS çš„ forin è¯­å¥
}[keyof T]
type FnKeyTypes = GetDemoFnKeyTypes<Demo, () => string[]> // 'd' | 'e'
```

## å–å±æ€§ç±»å‹

JS å¯¹è±¡é€šè¿‡ `.`æˆ–`[prop]` è·å–å±æ€§å€¼ï¼ŒTS ä¸­åˆ™å¯ä»¥é€šè¿‡åè€… `[prop]` è·å–å±æ€§ç±»å‹ï¼š

```ts
interface Person {
    name: string
    age: number
}
type Name = Person['name'] // string

/** æ•°ç»„ã€å…ƒç»„ã€å­—ç¬¦ç©¿ä¹Ÿå¯ä»¥é€šè¿‡ç´¢å¼•è·å–å¯¹åº”ä½ç½®çš„ç±»å‹*/
```

ç‰¹æ®Šçš„ï¼ŒåŸºç¡€ç±»å‹å¯ä»¥å–åˆ°åŸå‹çš„å®šä¹‰ï¼š

```ts
// String.prototype.concat çš„ç±»å‹å®šä¹‰
type Concat = 'hello'['concat'] // (...strings: string[]) => string
// Number.prototype.toFixed
type ToFixed = 1['toFixed'] // (fractionDigits?: number | undefined) => string
```

## keyof & typeof

`keyof` è·å–å…¬æœ‰å±æ€§çš„è”åˆç±»å‹ï¼›`typeof` æ¨å¯¼å‡º js å˜é‡çš„å¯¹åº”ç±»å‹ï¼š

```ts
class Person {
    public name: string
    public age: number
    private gender: boolean
}
type T1 = keyof Person // 'name' | 'age'
type T2 = keyof any // string | number | symbol

const Demo = [1, 'hello', true]
type T3 = (typeof Demo)[number] // number | string | boolean

// as const å¯ä»¥è®© typeof åœ¨è·å–ç±»å‹çš„æ—¶å€™è·å–åˆ°å­—é¢é‡ç±»å‹
const Demo = [1, 'hello', true] as const
type T4 = (typeof Demo)[number] // 1 | 'hello' | true
// è¿™åœ¨ç”¨ Record æ„é€ å¯¹è±¡æ—¶æ¯”è¾ƒå¸¸è§
// æ¯”å¦‚è¦ä¸´æ—¶æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œkey å–è‡ªæ•°ç»„ Aï¼Œvalue éœ€è¦ä»æ¥å£è¿”å›çš„æ•°ç»„ä¸­è·å–é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆåš
const A = ['a', 'b', 'c'] as const
const temp = {} as Record<(typeof A)[number], any> // {a: xxx, b: xxx, c : xxx}
```

å®é™…ä¸Šï¼Œä¸€èˆ¬ keyof å’Œ typeof ä¸€èµ·é…åˆä½¿ç”¨çš„åœºæ™¯éå¸¸å¤šï¼Œå¤šåŠ ç»ƒä¹ å³å¯ã€‚

## interface & type

TS å…¥é—¨æ—¶å¤šå¤šå°‘å°‘éƒ½ä¼šå¯¹è¿™ä¸¤ç©æ„å„¿æœ‰ç‚¹å›°æƒ‘å§ğŸ‘»

- `interface`
    - è‡ªèº«åªèƒ½è¡¨ç¤º `object/class/function` çš„ç±»å‹
    - åŒåçš„ `interface` ä¼šè‡ªåŠ¨èšåˆ
- `type`
    - åœ¨ TS ä¸­å……å½“äº†`åˆ«å`çš„ä½œç”¨ï¼Œå‡ ä¹å¯ä»¥è¡¨ç¤ºä¸€åˆ‡ç±»å‹
    - ä¸èƒ½åŒåï¼Œä½†æ”¯æŒæ›´å¤æ‚çš„ç±»å‹æ“ä½œ

é‰´äºä¸¤è€…çš„ç‰¹ç‚¹ï¼šå»ºè®®å¼€å‘åº“æ—¶å¯¹å¤–æš´éœ²çš„ç±»å‹å°½é‡ä½¿ç”¨ `interface/class`ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…è‡ªè¡Œæ‰©å±•ï¼Œå…¶ä»–æ—¶å€™å°½é‡ä½¿ç”¨ `type` å³å¯ã€‚

## é€†å˜ & åå˜

åå˜ï¼ˆCovarianceï¼‰å’Œé€†å˜ï¼ˆContravarianceï¼‰çš„æ¦‚å¿µç”¨äºæè¿°ç±»å‹ç³»ç»Ÿä¸­å­ç±»å‹å’Œçˆ¶ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚

ç®€å•è®²ï¼š

- `åå˜`ï¼Œæ„å‘³ç€å­ç±»å‹å¯ä»¥èµ‹å€¼ç»™çˆ¶ç±»å‹
- `é€†å˜`ï¼Œæ„å‘³ç€çˆ¶ç±»å‹å¯ä»¥èµ‹å€¼ç»™å­ç±»å‹

åœ¨ TS ä¸­ç‰¹æ®Šçš„ï¼Œ`å‡½æ•°çš„å‚æ•°æ˜¯é€†å˜çš„ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯åå˜çš„`

```ts
type Animal = {
    name: string
}
type Dog = Animal & { age: number }

let a!: () => Animal
let b!: () => Dog
a = b // ok
b = a // error

let c!: (param: Animal) => void
let d!: (param: Dog) => void
c = d // error
d = c // ok
```

> TS ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠå‡½æ•°å‚æ•°é»˜è®¤è®¾ç½®ä¸ºäº†åŒå˜çš„ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„ c = d ä¹Ÿæ˜¯ ok çš„ã€‚ä¸ºäº†è®©ç±»å‹ç³»ç»Ÿæ›´åŠ å‡†ç¡®ï¼Œå¯ä»¥åœ¨ tsconfig ä¸­é…ç½® `"strictFunctionTypes": true`ï¼Œè¿™æ ·å‡½æ•°å‚æ•°åªæœ‰é€†å˜çš„ç‰¹æ€§äº†ã€‚

## æ³›å‹ & infer

æ³›å‹éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯åœ¨è¿›è¡Œçº¦æŸæ—¶ï¼Œå¦‚æœæ³›å‹æ˜¯è”åˆç±»å‹ï¼Œé‚£ä¹ˆæ»¡è¶³`åˆ†é…å¾‹`ï¼š

```ts
type P<T> = T extends 'X' ? 1 : 2
type T1 = P<'X' | 'Y'> // 1 | 2

type T2 = 'X' | 'Y' extends 'X' ? 1 : 2 // 2 ç›´æ¥è¿›è¡Œçº¦æŸåˆ™æ²¡æœ‰åˆ†é…å¾‹
```

`infer` ç”¨åœ¨ `extends` ä¹‹åï¼Œç”¨æ¥æ¨æ–­ç±»å‹ï¼Œæ˜¯ç±»å‹ä½“æ“çš„å…³é”®å­—æ®µä¹‹ä¸€ï¼š

```ts
type A<T> = T extends { a: infer U; b: infer U } ? U : any
type B = A<{ a: string; b: number }> // string | number
```

## å†…ç½®ç±»å‹

- [å¸¸ç”¨å†…ç½®å·¥å…·ç±»å‹](https://www.typescriptlang.org/docs/handbook/utility-types.html)

ç†Ÿç»ƒä½¿ç”¨å†…ç½®ç±»å‹ï¼Œä¼šè®©ä½“æ“äº‹åŠåŠŸå€ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰ç”¨ zustand æ—¶ï¼Œå°è£…äº†ä¸€ä¸ª loading å‡½æ•°ï¼š

```ts
/**
 * ç”¨åˆ°äº† Parameters & ReturnType
 * ä½¿ç”¨çš„æ—¶å€™ const res = withLoading(apiService)(params),
 * å¾—ç›Šäº ts ç±»å‹æç¤ºï¼Œä¸Šé¢çš„ apiService çš„å‚æ•°ä¹Ÿæç¤ºåˆ° params çš„ä½ç½®
 */
export const withLoading = <T extends (...args: any[]) => Promise<any>>(asyncFunction: T) => {
    const setLoading = useLoading.getState().setLoading
    return async (...args: Parameters<T>): Promise<ReturnType<T> | undefined> => {
        setLoading(true)
        const [err, res] = await till(asyncFunction(...args))
        setLoading(false)
        if (err) {
            console.error(err)
            return
        }
        return res
    }
}
```

æœ€åï¼Œæ€»è€Œè¨€ä¹‹ï¼Œè¨€è€Œæ€»ä¹‹ --- èœå°±å¤šç»ƒğŸ¤£

å¦‚æœä½ æœ‰ TS ä½¿ç”¨çš„å°æŠ€å·§ï¼Œæ¬¢è¿åœ¨ä¸‹é¢çš„è¯„è®ºåŒºç•™è¨€ğŸ‘ğŸ»

## å‚è€ƒ

- [é‡å­¦ TS](https://juejin.cn/post/7211358106629750841)
- [Typescript ç±»å‹ç¼–ç¨‹ï¼Œä»å…¥é—¨åˆ°å¿µå¤´é€šè¾¾ğŸ˜‡](https://juejin.cn/post/7132490947320872974)
- [TypeScriptä¸­é«˜çº§åº”ç”¨ä¸æœ€ä½³å®è·µ](https://juejin.cn/post/6844903904140853255)
