---
title: 'å¼€å‘äº†ä¸€ä¸ªcli: @twotwoba/mk-app-cli'
date: '2024-05-22'
# lastmod: '1900-01-01'
tags: ['cli', 'react']
draft: false
summary: 'ä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶, ä½¿ç”¨ vite + react + typescript + tailwindcss + zustand + prettier + eslint.'
images: []
layout: PostLayout
---

## ç¼˜èµ·

ç»§ä¸Šæ¬¡æœ‰è¶£çš„ bug ä¹‹å, æˆ‘å°±ä¸€ç›´åœ¨æƒ³æŠŠé¡¹ç›®çš„æ•´ä½“æ¶æ„å˜ä¸€å˜, ä¹‹å‰æ˜¯åŸºäº `webpack` çš„ react è„šæ‰‹æ¶, ä½“éªŒè¿‡ `vite` çš„å¿«æ„Ÿè®©æˆ‘ä¸€ç›´å¿ƒå¿ƒå¿µå¿µäºå®ƒ.
å†å°±æ˜¯é¡¹ç›®ä¸­æ•°æ®ç®¡ç†ä½¿ç”¨çš„æ˜¯ `Rematch` è¿™ä¸ªåº“, ä¸€å¼€å§‹ç”¨ç€è¿˜æŒºèˆ’æœçš„, ä½†æ˜¯è‡ªä»ä½¿ç”¨è¿‡ `zustand` å, æˆ‘åˆç§»æƒ…åˆ«æ‹äº†~

äºæ˜¯ä¹æˆ‘å°±åœ¨æƒ³, ä¸å¦‚è‡ªå·±æ‰“é€ ä¸€ä¸ªç”¨èµ·æ¥é¡ºæ‰‹çš„æ¨¡æ¿å§ğŸ’£

## ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š

```sh
# ä½¿ç”¨äº†å®˜ç½‘æä¾›çš„æœ€åŸºç¡€çš„æ¨¡æ¿
pnpm create vite my-vue-app --template react-ts
```
ä¸‹é¢æ˜¯å…·ä½“åšçš„å·¥ä½œ:

- é…ç½® `preset.css`, æœ€ç®€å•çš„ css é¢„è®¾
- é…ç½® `prettier` å’Œ `eslint`, è§„èŒƒä»£ç æäº¤
- é…ç½® `tailwindcss`, åœ¨`settings.json`ä¸­æ·»åŠ  `tailwindCSS.experimental.classRegex`, ä½¿å¾—åœ¨å˜é‡ä¸­ä¹Ÿèƒ½ç»™å‡º `tailwindcss` æç¤º
- é…ç½® `zustand`, è¿›è¡ŒçŠ¶æ€ç®¡ç†, å†…ç½®äº† loading å¤„ç† store å’Œå‡½æ•°(å¯å‘äº Rematch çš„ loading æ’ä»¶).
    ```ts
    import till from '@/utils' // æŠŠ await-to-js æ¬è¿åˆ°é¡¹ç›®ä¸­äº†, å› ä¸ºæˆ‘è§‰å¾— till ä¸è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ›´åŒ¹é…
    import { create } from 'zustand'

    type State = {
        loading: boolean
    }
    type Action = {
        setLoading: (loading?: boolean) => void
    }
    const useLoading = create<State & Action>((set, get) => ({
        loading: false,
        setLoading: loading => {
            set({ loading: typeof loading === 'boolean' ? loading : !get().loading })
        }
    }))

    // è°ƒç”¨æ¥å£æ—¶ä½¿ç”¨, withLoading(xxxApi)(...params)
    export const withLoading = <T extends (...args: any[]) => Promise<any>>(asyncFunction: T) => {
        const setLoading = useLoading.getState().setLoading
        return async (...args: Parameters<T>): Promise<ReturnType<T> | undefined> => {
            setLoading(true)
            const [err, res] = await till(asyncFunction(...args))
            setLoading(false)
            if (err) {
                console.error(err)
                return
            }
            return res
        }
    }

    export default useLoading // é¡µé¢ä¸­ä½¿ç”¨
    ```

## å¼€å‘ cli

å†™ä¸€ä¸ª cli çš„æ–‡ç« å¤ªå¤šäº†, å’±å°±ä¸èµ˜è¿°äº†. ä»‹ç»ä¸€ä¸‹æŠ€æœ¯é€‰å‹å§: `commander + @inquirer/prompts + chalk + ora + shelljs + figlet`.

ç»“åˆä¸Šé¢è‡ªå·±é…ç½®çš„æ¨¡æ¿, å¾ˆå®¹å°±æŠŠè„šæ‰‹æ¶å†™å‡ºæ¥, å…·ä½“è¯·ç§»æ­¥: [mk-app-cli github](https://github.com/twotwoba/mk-app-cli).

å› ä¸ºä¹‹å‰é¡¹ç›®æ˜¯ç”¨çš„ `qiankun` æ¥åšå¾®å‰ç«¯çš„, ä½†æ˜¯æˆ‘çœ‹ `vite-plugin-qiankun` å·²ç»å¾ˆä¹…æ²¡æ›´æ–°äº†, ä¸Šä¸€æ¬¡æ›´æ–°è¿˜æ˜¯ 2 å¹´å‰, å› æ­¤æˆ‘åˆè€ƒå¯Ÿäº†å…¶ä»–æ–¹æ¡ˆ.
å…¶ä¸­ JD çš„ `Micro-app` å€Ÿé‰´ WebComponent çš„æ€æƒ³, é…ç½®éå¸¸ç®€å•, è€Œä¸”å¯¹ Vite æ”¯æŒå‹å¥½, äºæ˜¯é¡ºå…¶è‡ªç„¶çš„ `Micro-app` æˆä¸ºäº†ç»ä½³å€™é€‰. åœ¨ cli ä¸­é›†æˆæ—¶åˆ†ä¸ºäº†ä¸»åº”ç”¨å’Œå­åº”ç”¨, ä½¿å¾—åˆ›é€ å¾®å‰ç«¯é¡¹ç›®æ›´åŠ ç®€å•.

## å®‰è£…ä½¿ç”¨

```sh
npm i @twotwoba/mk-app-cli

mk web <project name>
```

æ¬¢è¿å„è·¯å¤§ä½¬æ issues å’Œ prğŸ‘.