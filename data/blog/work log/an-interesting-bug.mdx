---
title: 'è®°ä¸€æ¬¡æœ‰è¶£çš„ bug'
date: '2024-01-10'
tags: ['work log']
draft: false
summary: 'è¯·å‘Šè¯‰æˆ‘ [...new Set(arr)] çš„ç»“æœæ˜¯ä»€ä¹ˆ?'
images: []
---

## Question

æˆ‘æƒ³ä»»ä½•ä¸€ä¸ªå‰ç«¯å¼€å‘è€…éƒ½ä¼šä¸å‡æ€ç´¢åœ°è¯´å‡º `[...new Set(arr)]` ä¸å°±æ˜¯å¯¹æ•°ç»„ arr è¿›è¡Œç®€å•çš„å»é‡å˜›? è¿™å¤ªå¸¸ç”¨äº†.

æ˜¯çš„æ²¡é”™, è¿™ä¹Ÿå°±æ˜¯æˆ‘è‹¦æ¼çš„åœ°æ–¹, ä¸”å¬æˆ‘å¨“å¨“é“æ¥.

## èƒŒæ™¯

æŸä¸ªé¡¹ç›®ä½¿ç”¨çš„æ˜¯ vue3 æŠ€æœ¯æ ˆ, ä½†æ˜¯å…¬å¸è‡ªç ”çš„ç»„ä»¶åº“æ˜¯åŸºäº react çš„, å› æ­¤åœ¨é¢†å¯¼çš„è¦æ±‚ä¸‹, æˆ‘ä»¬å¯¹é¡¹ç›®è¿›è¡Œäº†é‡æ„.

ç»„é•¿æ‰¾äº†ä¸ªå¼€æºçš„ react é¡¹ç›®æ¨¡æ¿, äºæ˜¯æˆ‘ä»¬å¼€å¯äº†é£é£ç«ç«çš„é‡æ„ä¹‹è·¯. é—®é¢˜ä¹Ÿå°±æ­¤åŸ‹ä¸‹.

## å‘ç°é—®é¢˜

åœ¨å†™ä¸€ä¸ª echarts å›¾è¡¨, ä½†æ˜¯æ²¡æœ‰æŒ‰ç…§é¢„æœŸæŠŠå›¾æ¸²æŸ“å‡ºæ¥, æ£€æŸ¥ä¸‹ä»£ç , åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜, æŒ‰ç†è¯´åº”è¯¥å’Œåœ¨ vue ä¸­çš„è¡¨ç°ä¸€æ ·å‘€?
äºæ˜¯æˆ‘ debug äº†ä¸€ä¸‹, å¥½å®¶ä¼™ ğŸ˜‚ åœ¨ä¸€ä¸ªå¤„ç†æ•°æ®çš„å…¬å…±æ–¹æ³•ä¸­è®©æˆ‘å‘ç°äº†ç«¯å€ª: `[...new Set(arr)]` è¿”å›çš„ç»“æœæ‰“ç ´äº†æˆ‘çš„è®¤çŸ¥ --- æ¯”å¦‚ `[...new Set(1,1,2)]`, æŒ‰ç…§å¸¸è§„çš„ç†è§£,
åº”è¯¥fè¿”å› `[1, 2]`, ä½†åœ¨è¿™ä¸ªé¡¹ç›®é‡Œå°±ä¸ä¸€æ ·äº†, å®ƒè¿”å›çš„æ˜¯ `[Set(2)]`...å¹²äº†è¿™ä¹ˆå¤šå¹´, è¿˜çœŸå°±ç¬¬ä¸€æ¬¡è§~

## æ’æŸ¥

é¦–å…ˆæˆ‘é™·å…¥äº†è‡ªæˆ‘æ€€ç–‘ğŸ˜‚, éš¾é“æ˜¯æˆ‘è®°é”™äº†? äºæ˜¯æˆ‘èµ¶ç´§åˆ›å»ºäº†ä¸ª js, ç„¶å node è·‘äº†ä¸€ä¸‹, æ²¡æ¯›ç—…å‘€, å¾—åˆ°çš„æ˜¯æœŸæœ›çš„ `[1, 2]`.

é—®é¢˜å‡ºåœ¨å“ªé‡Œäº†å‘¢? å¾—ç›Šäºä¹‹å‰ç³»ç»Ÿåœ°å­¦ä¹ è¿‡ `babel` ç›¸å…³çŸ¥è¯†,æˆ‘çŒœæµ‹é—®é¢˜åº”è¯¥æ˜¯å‡ºç°åœ¨äº†ç¼–è¯‘é˜¶æ®µ, å¹¶ä¸”å¤§æ¦‚ç‡å’Œ `babel` çš„é…ç½®æœ‰å…³, äºæ˜¯æˆ‘çœ‹äº†ä¸‹ `.babelrc` æ–‡ä»¶, æœ‰è¿™ä¹ˆä¸€ä¸ªé…ç½®å¼•èµ·äº†æˆ‘çš„æ³¨æ„:

```js:.babelrc.js
module.exports = {
    presets: [
        [
            '@babel/preset-env',
            {
                useBuiltIns: 'usage',
                corejs: 3,
                loose: true // â• Here
            }
        ],
        // ...
    ]
    // ...
}
```

` loose: true`, è¿™æ˜¯ä¸ªå•¥å‘€? ä»¥å‰å¥½åƒä»æ¥æ²¡æœ‰ç”¨è¿‡, å…ˆå»å®˜ç½‘æœäº†ä¸€ä¸‹, æœ‰ç‚¹ä¸æ˜æ‰€ä»¥, å¯èƒ½æ˜¯å› ä¸ºç°åœ¨çš„æ–‡æ¡£æ¯”è¾ƒæ–°äº†, å¯¹è¿™ä¸ªæè¿°æ¯”è¾ƒç®€ç•¥.

äºæ˜¯æˆ‘åˆæ‰“å¼€ google æœç´¢å…³é”®å­—: "new set, babel loose", è¿˜çœŸè®©æˆ‘æœäº†ä¸€ç¯‡æ¯”è¾ƒè¯¦ç»†çš„æ–‡ç« : [Babel 6: loose mode](https://2ality.com/2015/12/babel6-loose-mode.html).
å…¶ä¸­, å¯¹äºå¼€å¯ loose çš„ç¼ºç‚¹æ˜¯è¿™ä¹ˆæè¿°çš„:

> You risk getting problems later on, when you switch from transpiled ES6 to native ES6. That is rarely a risk worth taking.

ç®€è¨€ä¹‹å°±æ˜¯åœ¨æŠŠç¼–è¯‘å¥½çš„ es6 ä»£ç è½¬ä¸ºåŸç”Ÿ es6 ä»£ç æ—¶æœ‰ä¸€å®šé£é™©äº§ç”Ÿä¸å¯é¢„çŸ¥çš„é—®é¢˜.

## è§£å†³

çŸ¥é“äº†ç—‡ç»“åœ¨å“ªé‡Œ, é‚£ä¹ˆå°±è§£å†³å°±å¾ˆå®¹æ˜“äº†. æŠŠ `loose` æ”¹ä¸º false å, `[...new Set(arr)]` çš„è¡¨ç°å°±å›å½’æ­£å¸¸äº†.

But, ä»¥é˜²è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„ä¸å¯é¢„çŸ¥çš„é—®é¢˜, æˆ‘è¿˜æ˜¯æ¯”è¾ƒè°¨æ…åœ°æŠŠ `[...new Set(arr)]` çš„è¯­æ³•æ”¹ä¸ºäº† `Array.from(new Set(arr))`, ä¹Ÿèƒ½è§£å†³é—®é¢˜, ä½¿å¾—å¯¹é¡¹ç›®æ•´ä½“çš„å½±å“æœ€å°, å®Œç¾è§£å†³.
